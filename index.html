<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Titre de la page</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<section class="hero">
  <nav>
    <div class="logo">LOGO</div>
    <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li>
          <a href="#cart">Cart <span id="cart-count">0</span></a>
        </li>
        <li><a href="#">About</a></li>
        <li><a href="#">Contact</a></li>
    </ul>
  </nav>
  <div id="cart-panel" class="cart-panel">
    <h3>🛒 My Cart</h3>
    <ul id="cart-items" class="cart-items"></ul>
    <div id="cart-total" class="cart-total">Total Price : $0</div>
    <button id="checkout-btn" class="checkout-btn">Buy</button>
  </div>

  <video autoplay muted loop playsinline class="bg-video">
    <source src="videos/fond.mp4" type="video/mp4">
  </video>

  <div class="hero-content">
    <h3 class="hero-subtitle">The</h3>
    <h1 class="hero-title">Denim Studio</h1>
  </div>
</section>

<div class="cards-container">
    <div class="card blue">
      <a href="product1.html" class="card blue">
      <div class="product">
        <span class="number">01</span>
        <span class="sneakers">SHORT</span>
        <span class="price">$39.9</span>
        <img src="images/short.png">
      </div>
      <div class="title">
        <h2>Burberry Short</h2>
      </div>
      </a>
    </div>
    <div class="card pink">
      <a href="product2.html" class="card pink">
      <div class="product">
        <span class="number">02</span>
        <span class="sneakers">SANDAL</span>
        <span class="price">$39.9</span>
        <img src="images/sandal.png">
      </div>
      <div class="title">
        <h2>Burberry Sandal</h2>
      </div>
    </a>
    </div>
    <div class="card purple">
      <a href="product3.html" class="card purple">
      <div class="product">
        <span class="number">03</span>
        <span class="sneakers">JACKET</span>
        <span class="price">$39.9</span>
        <img src="images/doudoune.png">
      </div>
      <div class="title">
        <h2>Burberry Jacket</h2>
      </div>
      </a>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.2/vanilla-tilt.min.js"></script>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        VanillaTilt.init(document.querySelectorAll(".card"), {
            max: 25,
            speed: 5000,
            glare: true,
            "max-glare": 0.5,
        });
    });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  // Tester d'abord la disponibilité du stockage
  testStorageAvailability();
  
  const cartCount = document.getElementById('cart-count');
  const cartPanel = document.getElementById('cart-panel');
  const cartItemsList = document.getElementById('cart-items');
  const checkoutBtn = document.getElementById('checkout-btn');
  const cartTotal = document.getElementById('cart-total');

  function formatPrice(price) {
    return price.toFixed(2).replace('.', ',') + ' €';
  }

  function saveCart(cart) {
    try {
      localStorage.setItem('myCart', JSON.stringify(cart));
      // Vérification immédiate pour confirmer que les données ont été sauvegardées
      const verification = localStorage.getItem('myCart');
      if (!verification) {
        console.warn("⚠️ La sauvegarde paraît avoir échoué - aucune donnée récupérée");
      }
    } catch (e) {
      console.warn("⚠️ localStorage sauvegarde échouée", e);
      // Tentative de sauvegarde alternative avec sessionStorage
      try {
        sessionStorage.setItem('myCart', JSON.stringify(cart));
      } catch (e2) {
        console.error("❌ Impossible de sauvegarder le panier", e2);
      }
    }
  }

  function loadCart() {
    try {
      // Tentative principale avec localStorage
      const stored = localStorage.getItem('myCart');
      if (stored) {
        return JSON.parse(stored);
      }
      
      // Si localStorage est vide, essai avec sessionStorage
      const storedSession = sessionStorage.getItem('myCart');
      if (storedSession) {
        return JSON.parse(storedSession);
      }
      
      return [];
    } catch (e) {
      console.warn("⚠️ Erreur d'accès au stockage", e);
      return [];
    }
  }

  function updateCartDisplay() {
    const cartData = loadCart();
    cartItemsList.innerHTML = '';
    let cartItems = 0;
    let totalPrice = 0;

    cartData.forEach((item, index) => {
      cartItems += item.quantity;
      totalPrice += item.quantity * item.price;

      const li = document.createElement('li');
      li.setAttribute('data-index', index);
      li.setAttribute('data-quantity', item.quantity);
      const itemTotal = item.quantity * item.price;
      li.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div class="item-info">
          ${item.quantity}x ${item.name} – ${formatPrice(item.price)}<br>
          <small>Size ${item.size} | Total: ${formatPrice(itemTotal)}</small>
        </div>
        <button class="remove-btn" title="Retirer">✖</button>
      `;


      li.querySelector('.remove-btn').addEventListener('click', () => {
        const updatedCart = loadCart();
        updatedCart.splice(index, 1);
        saveCart(updatedCart);
        updateCartDisplay();
      });

      cartItemsList.appendChild(li);
    });

    cartCount.textContent = cartItems;
    cartCount.style.display = cartItems > 0 ? "inline-block" : "none";
    cartTotal.textContent = `Total Price : ${formatPrice(totalPrice)}`;
  }

  updateCartDisplay();

  const cartLink = document.querySelector('a[href="#cart"]');
  if (cartLink) {
    cartLink.addEventListener('click', (e) => {
      e.preventDefault();
      cartPanel.style.display = cartPanel.style.display === 'none' ? 'block' : 'none';
    });
  }

  checkoutBtn.addEventListener('click', () => {
    const cartData = loadCart();
    if (cartData.length === 0) {
      alert("Your shopping cart is empty!");
    } else {
      alert("Thank you for your order!");
      saveCart([]);
      updateCartDisplay();
      cartPanel.style.display = 'none';
    }
  });
});

function testStorageAvailability() {
  const testKey = 'test_storage';
  try {
    localStorage.setItem(testKey, 'test');
    if (localStorage.getItem(testKey) === 'test') {
      localStorage.removeItem(testKey);
      console.log('✅ localStorage disponible');
      return true;
    }
    return false;
  } catch (e) {
    console.warn('⚠️ localStorage indisponible', e);
    // Afficher une notification à l'utilisateur si le localStorage n'est pas disponible
    displayStorageWarning();
    return false;
  }
}

function displayStorageWarning() {
  // Créer une notification pour informer l'utilisateur
  const warning = document.createElement('div');
  warning.style.cssText = 'position:fixed; top:10px; left:50%; transform:translateX(-50%); background:#fff3cd; color:#856404; padding:10px 20px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:9999; text-align:center;';
  warning.innerHTML = 'Attention : le stockage local est désactivé ou inaccessible. Votre panier ne sera pas conservé entre les sessions.';
  document.body.appendChild(warning);
  
  // Faire disparaître après 5 secondes
  setTimeout(() => {
    warning.style.opacity = '0';
    warning.style.transition = 'opacity 1s';
    setTimeout(() => warning.remove(), 1000);
  }, 5000);
}
</script>


</body>
</html>