<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Page</title>
  <link rel="stylesheet" href="style3.css">
</head>
<body>
  <nav>
    <div class="logo">LOGO</div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li>
        <a href="#cart">Cart <span id="cart-count">0</span></a>
      </li>
      <li><a href="#">About</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
  <div id="cart-panel" class="cart-panel">
    <h3>🛒 My Cart</h3>
    <ul id="cart-items" class="cart-items"></ul>
    <div id="cart-total" class="cart-total">Total Price : $0</div>
    <button id="checkout-btn" class="checkout-btn">Buy</button>
  </div>

  <section class="container">
    <div class="content-wrapper">
      <div class="images-and-sizes">
        <div class="image-slider">
          <div class="slider-container">
            <img src="images/sandal.png" alt="Pink">
            <img src="images/sandal2.png" alt="Pink">
            <img src="images/sandal3.png" alt="Pink">
          </div>
          <div class="slider-buttons">
            <button class="slider-prev">&#10094;</button>
            <button class="slider-next">&#10095;</button>
          </div>
        </div>
        <div class="slideshow-buttons">
          <span class="focus" data-index="0"></span>
          <span data-index="1"></span>
          <span data-index="2"></span>
        </div>
        <p class="pick">CHOOSE SIZE</p>
        <div class="sizes">
          <span>39</span>
          <span>40</span>
          <span>41</span>
          <span>42</span>
          <span>43</span>
          <span>44</span>
          <span>45</span>
        </div>
      </div>

      <div class="product">
        <p class="category">SANDAL</p>
        <h1>Burberry Sandal</h1>
        <h2>$39.9</h2>
        <p class="description">
          Iconic slides with a signature check print. Comfort and elegance combine for a stylish everyday look.</p>
        <div class="quantity-selector">
            <button id="decrease">-</button>
            <span id="quantity">1</span>
            <button id="increase">+</button>
          </div>
        <div class="buttons">
          <button class="add">ADD TO CART</button>
        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Test de disponibilité du localStorage
      function testStorageAvailability() {
        const testKey = 'test_storage';
        try {
          localStorage.setItem(testKey, 'test');
          if (localStorage.getItem(testKey) === 'test') {
            localStorage.removeItem(testKey);
            console.log('✅ localStorage disponible');
            return true;
          }
          return false;
        } catch (e) {
          console.warn('⚠️ localStorage indisponible', e);
          displayStorageWarning();
          return false;
        }
      }
  
      // Affichage d'un avertissement si le localStorage n'est pas disponible
      function displayStorageWarning() {
        const warning = document.createElement('div');
        warning.style.position = 'fixed';
        warning.style.top = '10px';
        warning.style.left = '50%';
        warning.style.transform = 'translateX(-50%)';
        warning.style.backgroundColor = '#ffcc00';
        warning.style.padding = '10px';
        warning.style.borderRadius = '5px';
        warning.style.zIndex = '1000';
        warning.textContent = "⚠️ Votre navigateur ne supporte pas le stockage local. Certaines fonctionnalités peuvent être limitées.";
        document.body.appendChild(warning);
      }
  
      // Appel de la fonction de test de disponibilité du stockage
      testStorageAvailability();
  
      // === SLIDER ===
      const sliderContainer = document.querySelector('.slider-container');
      const slideshowButtons = document.querySelectorAll('.slideshow-buttons span');
      const prevButton = document.querySelector('.slider-prev');
      const nextButton = document.querySelector('.slider-next');
      const totalSlides = document.querySelectorAll('.slider-container img').length;
      let currentSlide = 0;
  
      function updateSlider() {
        sliderContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
        slideshowButtons.forEach((button, index) => {
          button.classList.toggle('focus', index === currentSlide);
        });
      }
  
      prevButton?.addEventListener('click', () => {
        currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
        updateSlider();
      });
  
      nextButton?.addEventListener('click', () => {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateSlider();
      });
  
      slideshowButtons.forEach((button, index) => {
        button.addEventListener('click', () => {
          currentSlide = index;
          updateSlider();
        });
      });
  
      // === SIZES ===
      const sizeSpans = document.querySelectorAll('.sizes span');
      sizeSpans.forEach(span => {
        span.addEventListener('click', () => {
          sizeSpans.forEach(s => s.classList.remove('focus'));
          span.classList.add('focus');
        });
      });
  
      // === QUANTITY ===
      let quantity = 1;
      const quantityDisplay = document.getElementById('quantity');
      const increaseBtn = document.getElementById('increase');
      const decreaseBtn = document.getElementById('decrease');
  
      increaseBtn?.addEventListener('click', () => {
        quantity++;
        quantityDisplay.textContent = quantity;
      });
  
      decreaseBtn?.addEventListener('click', () => {
        if (quantity > 1) {
          quantity--;
          quantityDisplay.textContent = quantity;
        }
      });
  
      // === PANIER ===
      const addButton = document.querySelector('.add');
      const cartCount = document.getElementById('cart-count');
      const cartPanel = document.getElementById('cart-panel');
      const cartItemsList = document.getElementById('cart-items');
      const checkoutBtn = document.getElementById('checkout-btn');
      const cartTotal = document.getElementById('cart-total');
      cartPanel.style.display = 'none';
  
      const itemPrice = 39.9;
      let cartItems = 0;
      let totalPrice = 0;
  
      function formatPrice(price) {
        return price.toFixed(2).replace('.', ',') + ' €';
      }
  
      function saveCart(cart) {
        try {
          localStorage.setItem('myCart', JSON.stringify(cart));
          // Vérification immédiate pour confirmer que les données ont été sauvegardées
          const verification = localStorage.getItem('myCart');
          if (!verification) {
            console.warn("⚠️ La sauvegarde paraît avoir échoué - aucune donnée récupérée");
          }
        } catch (e) {
          console.warn("⚠️ localStorage sauvegarde échouée", e);
          // Tentative de sauvegarde alternative avec sessionStorage
          try {
            sessionStorage.setItem('myCart', JSON.stringify(cart));
          } catch (e2) {
            console.error("❌ Impossible de sauvegarder le panier", e2);
          }
        }
      }
  
      function loadCart() {
        try {
          // Tentative principale avec localStorage
          const stored = localStorage.getItem('myCart');
          if (stored) {
            return JSON.parse(stored);
          }
  
          // Si localStorage est vide, essai avec sessionStorage
          const storedSession = sessionStorage.getItem('myCart');
          if (storedSession) {
            return JSON.parse(storedSession);
          }
  
          return [];
        } catch (e) {
          console.warn("⚠️ Erreur d'accès au stockage", e);
          return [];
        }
      }
  
      let cartData = loadCart();
  
      function updateCartDisplay() {
        cartItemsList.innerHTML = '';
        cartItems = 0;
        totalPrice = 0;
  
        cartData.forEach((item, index) => {
          cartItems += item.quantity;
          totalPrice += item.quantity * item.price;
  
          const li = document.createElement('li');
          li.setAttribute('data-index', index);
          li.setAttribute('data-quantity', item.quantity);
          const itemTotal = item.quantity * item.price;
          li.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div class="item-info">
              ${item.quantity}x ${item.name} – ${formatPrice(item.price)}<br>
              <small>Size ${item.size} | Total: ${formatPrice(itemTotal)}</small>
            </div>
            <button class="remove-btn" title="Retirer">✖</button>
          `;
  
          li.querySelector('.remove-btn').addEventListener('click', () => {
            cartData.splice(index, 1);
            saveCart(cartData);
            updateCartDisplay();
          });
  
          cartItemsList.appendChild(li);
        });
  
        cartCount.textContent = cartItems;
        cartCount.style.display = cartItems > 0 ? "inline-block" : "none";
        cartTotal.textContent = `Total Price : ${formatPrice(totalPrice)}`;
      }
  
      updateCartDisplay();
  
      addButton?.addEventListener('click', (e) => {
        const selectedSize = document.querySelector('.sizes .focus');
        if (!selectedSize) {
          e.preventDefault();
          alert("Please select a size before adding to cart.");
          return;
        }
  
        const newItem = {
          name: "Sandal", // Ajuster ce champ pour chaque produit
          size: selectedSize.textContent,
          quantity: quantity,
          price: itemPrice,
          image: "images/sandal.png" // Ajuster ce champ pour chaque produit
        };
  
        cartData.push(newItem);
        saveCart(cartData);
        updateCartDisplay();
  
        quantity = 1;
        quantityDisplay.textContent = quantity;
      });
  
      const cartLink = document.querySelector('a[href="#cart"]');
      if (cartLink) {
        cartLink.addEventListener('click', (e) => {
          e.preventDefault();
          cartPanel.style.display = cartPanel.style.display === 'none' ? 'block' : 'none';
        });
      }
  
      checkoutBtn?.addEventListener('click', () => {
        if (cartItemsList.children.length === 0) {
          alert("Your shopping cart is empty!");
        } else {
          alert("Thank you for your order!");
          cartData = [];
          saveCart(cartData);
          updateCartDisplay();
          cartPanel.style.display = 'none';
        }
      });
    });
  </script>
  
</body>
</html>